// Credit: XRegExp 0.6.1 (c) 2007-2008 Steven Levithan <http://stevenlevithan.com/regex/xregexp/> MIT License

(function(t){"function"==typeof define&&define.amd?define("epik/index",["primish/primish","primish/options","primish/emitter","lodash"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("primish"),require("primish/options"),require("primish/emitter"),require("lodash")):this.epik=t(this.primish,this.options,this.emitter,this._)}).call(this,function(t,e,i,n,r){var s={setter:function(t){return function(e,i){if(null==e)return t;if(n.isObject(e))for(var r in e)t.call(this,r,e[r]);else t.call(this,e,i)}},getter:function(t){return function(e){var i,n,r;if(n="string"!=typeof e?e:arguments.length>1?arguments:!1)for(i={},r=0;r<n.length;r++)i[n[r]]=t.call(this,n[r]);else i=t.call(this,e);return i}}},o=t.slice,u=t("emitter",{extend:i,listenTo:function(e,i,r){var s=typeof i,o={context:e,subscriber:this},u=e._subscribers||t.hide(e,"_subscribers",{});return"function"===s?(r=i,i="*",delete o.event):"undefined"===s?(i="*",delete o.event):"string"===s&&(o.event=i),r&&(o.fn=r),u[i]||(u[i]=[]),-1===n.indexOf(u[i],o)&&u[i].push(o),this},stopListening:function(t,e,i){return n.forIn(t._subscribers,function(n,r,s){if(s=n.length,"undefined"!=typeof e){if(r===e)for(;s--;)(i&&i===n[s].fn||!i)&&n[s].context===t&&n.splice(s,1)}else for(;s--;)n[s].context===t&&n.splice(s,1)}),this},trigger:function(t){var e,i,n,r,s,u=this._listeners,h=this._subscribers;if(u&&u[t]){n=arguments.length>1?o(arguments,1):[];for(e in u[t])u[t][e].apply(this,n)}if(h){for(u=h["*"]||[],e=0,i=u.length;i>e;e++)s=u[e],r=s.event?n:arguments,s.fn?s.fn.apply(s.context,r):this.trigger.apply(s.subscriber,r);for(u=h[t]||[],e=0,i=u.length;i>e;e++)s=u[e],r=s.event?n:arguments,s.fn?s.fn.apply(s.context,r):this.trigger.apply(s.subscriber,arguments)}return this},offAll:function(t){var e,i=this._listeners,n=this._subscribers;return t&&t.length?(i&&(e=i[t])&&delete i[t],n&&(e=n[t])&&delete n[t],this):(this._listeners={},this._subscribers={},this)}});return u.prototype.on=s.setter(u.prototype.on),{_:n,primish:t,options:e,emitter:u,slicker:r,util:s}}),function(t){"function"==typeof define&&define.amd?define("epik/agent",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.agent=t(this.epik)}.call(this,function(t){var e=t.primish,i=t.emitter,n=t.options,r=t._,s=function(){var t=String.prototype.trim;return t?function(e){return t.call(e)}:function(t){return String(t).replace(/^\s+|\s+$/gm,"")}}(),o=function(t){return String(t).replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},u=function(){var t=function(){return new XMLHttpRequest},e=function(){return new ActiveXObject("MSXML2.XMLHTTP")},i=function(){return new ActiveXObject("Microsoft.XMLHTTP")};try{return t(),t}catch(n){}try{return e(),e}catch(n){}try{return i(),i}catch(n){}return null}(),h=function(t){return null==t?"":t.toJSON?t.toJSON():JSON.stringify(t)},a=function(t,e){if(null==t)return"";if(t.toQueryString)return t.toQueryString();var i=[];return r.forIn(t,function(t,n){e&&(t=e+"["+t+"]");var s;if(null!=n){if(r.isArray(n)){for(var o={},u=0;u<n.length;u++)o[u]=n[u];s=a(o,t)}else s=r.isObject(n)?a(n,t):t+"="+encodeURIComponent(n);i.push(s)}}),i.join("&")},l=JSON.parse,c=function(t){for(var e=t.split("&"),i={},n=0;n<e.length;n++){var r=e[n].split("="),s=decodeURIComponent(r[0]),o=decodeURIComponent(r[1]),u=/\[\]$/.test(s),h=s.match(/^(.+)\[([^\]]+)\]$/);if(h){s=h[1];var a=h[2];i[s]=i[s]||{},i[s][a]=o}else u?(s=s.substring(0,s.length-2),i[s]=i[s]||[],i[s].push(o)):i[s]=o}return i},d={"application/json":h,"application/x-www-form-urlencoded":a},f={"application/json":l,"application/x-www-form-urlencoded":c},p=function(t){var e=t.split(/\r?\n/),i={};e.pop();for(var n=0,r=e.length;r>n;++n){var u=e[n],h=u.indexOf(":"),a=o(u.slice(0,h)),l=s(u.slice(h+1));i[a]=l}return i},g=e({options:{header:{"Content-Type":"application/x-www-form-urlencoded"},url:null,method:"post",data:null,user:null,password:null,emulation:!1},implement:[i,n],constructor:function(t){var e=this._xhr=u(),i=this;this.setOptions(t),this.options.data&&this.data(r.clone(this.options.data)),this.options.header&&this.header(this.options.header),e.addEventListener&&r.forEach("progress|load|error|abort|loadend".split("|"),function(t){e.addEventListener(t,function(e){i.trigger(t,e)},!1)})},header:function(t,e){var i=this.options.header;if(r.isObject(t))for(var n in t)this.header(n,t[n]);else{if(!arguments.length)return i;if(1===arguments.length)return i[o(t)];2===arguments.length&&(null==e?delete i[o(t)]:i[o(t)]=e)}return this},running:function(){return!!this._running},abort:function(){return this._running&&(this._xhr.abort(),delete this._running,this._xhr.onreadystatechange=function(){},this._xhr=u()),this},method:function(t){return arguments.length?(this.setOptions({method:t.toUpperCase()}),this):this.options.method},data:function(t){return arguments.length?(this._data=t,this):this._data},url:function(t){return arguments.length?(this.setOptions({url:t}),this):this.options.url},user:function(t){return arguments.length?(this.setOptions({user:t}),this):this.options.user},password:function(t){return arguments.length?(this.setOptions({password:t}),this):this.options.password},send:function(t){t||(t=function(){}),this._running&&this.abort();var e,i=this.options,n=i.method,r=this._data||null,s=i.url,o=i.user,u=i.password,h=this,a=this._xhr;if(i.emulation&&/get|post/i.test(n)){var l="_method="+n;r=r?l+"&"+r:l,n="post"}r&&"string"!=typeof r&&(e=d[i.header["Content-Type"].split(/ *; */).shift()],e&&(r=e(r))),/get|head/i.test(n)&&r&&(s+=(s.indexOf("?")>-1?"&":"?")+r),this._running=!0,a.open(n,s,!0,o,u),null!=o&&"withCredentials"in a&&(a.withCredentials=!0),a.onreadystatechange=function(){if(4===a.readyState){var e=a.status,i=new m(a.responseText,e,p(a.getAllResponseHeaders()));delete h._running,a.onreadystatechange=function(){},h.trigger(i.error?"failure":"success",i).trigger("complete",i),t(i)}};for(var c in i.header)a.setRequestHeader(c,i.header[c]);return this.trigger("request"),a.send(r||null),this}}),m=e({constructor:function(t,e,i){this.text=t,this.status=e;var n,r=i["Content-Type"]?i["Content-Type"].split(/ *; */).shift():"",s=e/100|0;this.header=i,this.info=1===s,this.ok=2===s,this.clientError=4===s,this.serverError=5===s,this.error=4===s||5===s,this.accepted=202===e,this.noContent=204===e||1223===e,this.badRequest=400===e,this.unauthorized=401===e,this.notAcceptable=406===e,this.notFound=404===e,this.noContent||(n=f[r]),this.body=n?n(this.text):this.text},header:function(t){return t?this._header[o(t)]:null}}),v="get|post|put|delete|head|patch|options",y=RegExp("^"+v+"$","i"),b=function(t,e,i,n){var s=new g;return y.test(t)||(n=i,i=e,e=t,t="post"),r.isFunction(i)&&(n=i,i=null),s.method(t),e&&s.url(e),i&&s.data(i),n&&s.send(n),s};return b.encoder=function(t,e){return 1===arguments.length?d[t]:(d[t]=e,b)},b.decoder=function(t,e){return 1===arguments.length?f[t]:(f[t]=e,b)},r.forEach(v.split("|"),function(t){b[t]=function(e,i,n){return b(t,e,i,n)}}),b.Request=g,b.Response=m,b}),function(t){"function"==typeof define&&define.amd?define("epik/model",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.model=t(this.epik)}.call(this,function(t){var e=t.primish,i=t.options,n=t.emitter,r=t._,s=t.util,o=t.primish.slice;return e("model",{implement:[i,n],properties:{id:{get:function(){var t=this._attributes.id||r.uniqueId("model-");return this.cid||(this.cid=t),this._attributes.id||t}}},options:{},validators:[],constructor:function(t,i){return this._collections=[],this._attributes={},t&&"object"==typeof t||(t={}),this.defaults&&r.defaults(t,r.cloneDeep(this.defaults)),this.set(t),this.setOptions(i),e.hide(this,"isEqual",r.isEqual),this.trigger("ready")},set:function(){return this.propertiesChanged=[],this.validationFailed=[],this._set.apply(this,arguments),this.propertiesChanged.length&&this.trigger("change",this.propertiesChanged),this.validationFailed.length&&this.trigger("error",this.validationFailed),this},_set:s.setter(function(t,e){if("undefined"==typeof t||"undefined"==typeof e)return this;var i=this._attributes,n=this.properties;if(n[t]&&n[t].set&&(e=n[t].set.call(this,e),"undefined"==typeof e))return this;if(i.hasOwnProperty(t)&&this.isEqual(i[t],e))return this;if(this.validators.hasOwnProperty(t)){var r=this.validate(t,e);if(r!==!0){var s={key:t,value:e,error:r};return this.validationFailed.push(s),this.trigger("error:"+t,s),this}}return i[t]=e,this.trigger("change:"+t,e),this.propertiesChanged.push(t),this}),get:s.getter(function(t){return t&&this.properties[t]&&this.properties[t].get?this.properties[t].get.call(this):t&&"undefined"!=typeof this._attributes[t]?this._attributes[t]:null}),validate:function(t,e){return this.validators[t].call(this,e)},unset:function(){var t=o(arguments),e=[],i=t.length,n=this._attributes;if(!i)return this;if(r.forEach(r.flatten(t),function(t){n.hasOwnProperty(t)&&(delete n[t],e.push(t))}),i=e.length){for(this.propertiesChanged=e;i--;)this.trigger("change:"+e[i],null);this.trigger("change",e)}return this},empty:function(){var t=r.keys(this._attributes),e=this;return this.trigger("change",t),r.forEach(t,function(t){e.trigger("change:"+t,null)}),this._attributes={},this.trigger("empty"),this},destroy:function(){return this._attributes={},this.trigger("destroy"),this},toJSON:function(){return r.cloneDeep(this._attributes)}})}),function(t){"function"==typeof define&&define.amd?define("epik/model-sync",["./index","./model","./agent"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./model"),require("./agent")):this.epik.model.sync=t(this.epik,this.epik.model,this.epik.agent)}.call(this,function(t,e,i){var n=t.primish,r=t._,s="sync:",o={create:"post",read:"get",update:"put",delete_:"delete"},u=e.prototype.properties;return delete u.id.get,u=r.merge(u,{urlRoot:{set:function(t){this.urlRoot=t,delete this._attributes.urlRoot},get:function(){var t=this.urlRoot||this.options.urlRoot||"no-urlRoot-set";return"/"!==t.charAt(t.length-1)&&(t+="/"),t}}}),n({extend:e,properties:u,options:{headers:{"Content-Type":"application/json"}},constructor:function(t,e){return this._attributes={},this.setOptions(e),this._setupSync(),this.parent("constructor",t,e),this},_setupSync:function(){var t=this;return this.request=new i.Request({url:this.get("urlRoot"),onFailure:function(e){t.trigger(s+"error",this.options.method,this.options.url,this.options.data),t.trigger("requestFailure",e.status,e.text)},onSuccess:function(e){t.postProcessor&&(e.body=t.postProcessor(e.body)),t.isNewModel=!1,t.trigger("sync",e.body,t.request.options.method,t.request._data)}}),this.options.headers&&this.request.header(this.options.headers),r.forIn(o,function(e,i){t[i]=function(t){this.sync(i,this.toJSON(),t)}}),this},sync:function(t,e,i){var n,r={},s=this;return t="string"==typeof t?t&&o[t]?o[t]:o.read:o.read,r.method=t,n=typeof e,"function"===n&&(i=e),("undefined"===n||"function"===n)&&(e=this.toJSON()),this.request.data(void 0),(t===o.create||t===o.update)&&(this.preProcessor&&(e=this.preProcessor(e)),this.request.data(e)),r.url=[this.get("urlRoot"),this.get("id")].join(""),"/"!==r.url.slice(-1)&&(r.url+="/"),delete this.request.options,this.request.setOptions(r).send(function(t){s.trigger(t.error?"failure":"success",t),i&&i.call(s,t)}),this},_setResponse:function(t){return t.body&&"object"==typeof t.body&&this.set(t.body),this},fetch:function(){return this.read(function(t){t.error||(this.isNewModel=!1,this._setResponse(t).trigger("fetch"))}),this},save:function(t,e){var i=["update","create"][+this.isNew()];if(t){var n=typeof t,s="object"===n&&r.isObject(t)||"string"===n&&"undefined"!=typeof e;s&&this._set.apply(this,arguments)}return this[i](function(t){t.error||(this.isNewModel=!1,this._setResponse(t).trigger("save").trigger(i))}),this},isNew:function(){return"undefined"==typeof this.isNewModel&&(this.isNewModel=null==this.get("id")),this.isNewModel}})}),function(t){"function"==typeof define&&define.amd?define("epik/storage",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.storage=t(this.epik)}.call(this,function(t){var e=t.primish,i=t._,n=this;return function(){var t=!("object"!=typeof n.localStorage||!n.localStorage.getItem),r="localStorage",s="sessionStorage",o=function(r){var s,o="epik-"+r,u={},h="model";if(t)try{u=JSON.parse(n[r].getItem(o))||u}catch(a){t=!1}if(!t)try{s=JSON.parse(n.name),s&&"object"==typeof s&&s[o]&&(u=s[o])}catch(l){g()}var c={store:function(t){t=t||this.toJSON(),f([h,this.get("id")].join(":"),t),this.trigger("store",t)},eliminate:function(){return p([h,this.get("id")].join(":")),this.trigger("eliminate")},retrieve:function(){var t=d([h,this.get("id")].join(":"))||null;return this.trigger("retrieve",t),t}},d=function(t){return t in u?u[t]:null},f=function(e,i){if(u=t?JSON.parse(n[r].getItem(o))||u:u,u[e]=i,t)try{n[r].setItem(o,JSON.stringify(u))}catch(s){}else g();return this},p=function(e){if(delete u[e],t)try{n[r].setItem(o,JSON.stringify(u))}catch(i){}else g()},g=function(){var t={},e=JSON.parse(n.name);t[o]=u,n.name=JSON.stringify(i.merge(t,e))};return function(t){return h=t,e(i.clone(c))}};return{localStorage:o(r),sessionStorage:o(s)}}()}),function(t){"function"==typeof define&&define.amd?define("epik/collection",["./index","./model","slicker"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./model"),require("slicker")):this.epik.collection=t(this.epik,this.epik.model,this.slicker)}.call(this,function(t,e,i){var n=t.primish,r=t.options,s=t.emitter,o=t._,u=t.primish.slice,h=n("collection",{implement:[s,r],model:e,constructor:function(t,e){return this.setOptions(e),this._models=[],this.length=0,t&&this.set(t,!0),this.id=this.options.id||o.uniqueId(),this.trigger("ready")},set:function(t,e){var i=this;return this.length&&this.remove(this._models,!0),o.isArray(t)||(t=[t]),o.forEach(t,function(t){i.add(t,!0)}),e||this.trigger("set",this._models),this},add:function(t,e){var i,n=this;return(o.isObject(t)&&!(t instanceof this.model)||"undefined"==typeof t&&this.model.prototype.defaults)&&(t=t?new this.model(t):new this.model,t.validationFailed.length)?this.trigger("add:error",t,"Validation failed"):(t.cid=t.cid||t.get("id")||o.uniqueId("c"),i=this.getModelByCID(t.cid),i&&e!==!0?this.trigger("add:error",t):(i&&e===!0&&(this._models[o.indexOf(this._models,t)]=t),this.listenTo(t,function(e){var i=u(arguments);i.splice(1,0,t),n.trigger.apply(n,i),"destroy"===e&&n.remove(t,!0)}),this._models.push(t),-1===o.indexOf(t._collections,this)&&t._collections.push(this),this.length=this._models.length,this.trigger("add",t,t.cid).trigger("reset",t,t.cid),t))},remove:function(t,e){var i=this;return o.isArray(t)||(t=[t]),o.forEachRight(t,function(t){t._collections.splice(o.indexOf(t._collections,i),1),i._models.splice(o.indexOf(i._models,t),1),i.stopListening(t),i.length=i._models.length,e||i.trigger("remove",t,t.cid)}),e||this.trigger("reset",t),this},get:function(t){return this[t]},getModelByCID:function(t){var e=null;return this.some(function(i){return i.cid===t&&(e=i)}),e},getModelById:function(t){var e=null;return this.some(function(i){return i.get("id")===t&&(e=i)}),e},at:function(t){return this._models[t]},toJSON:function(){return o.map(this._models,function(t){return t.toJSON()})},empty:function(t){return this.remove(this._models,t),t||this.trigger("empty"),this},sort:function(t){if(!t)return this._models.sort(),this.trigger("sort");if("function"==typeof t)return this._models.sort(t),this.trigger("sort");var e="asc",i=t.split(","),n=function(t,e){return e>t?-1:t>e?1:0};return this._models.sort(function(t,r){var s=0;return o.some(i,function(i){i=i.trim();var o=i.split(":"),u=o[0],h=o[1]?o[1]:e,a=t.get(u),l=r.get(u),c=n(a,l),d={asc:c,desc:-c};return"undefined"==typeof d[h]&&(h=e),s=d[h],0!==s}),s}),this.trigger("sort")},reverse:function(){return this._models.reverse(),this.trigger("sort")},find:function(t){var e=i.parse(t),n=[],r=this,s={"=":function(t,e){return t==e},"!=":function(t,e){return t!=e},"^=":function(t,e){return 0===t.indexOf(e)},"*=":function(t,e){return-1!==t.indexOf(e)},"$=":function(t,e){return t.indexOf(e)==t.length-e.length},"*":function(t){return"undefined"!=typeof t}},u=function(t){return t&&s[t]?s[t]:null},h=function(t){var e=t.key,i=t.value||null,n=t.tag||null,s=u(t.operator);r=r.filter(function(t){var r,o;return n&&e?(r=t.get(n),o=r?r[e]:null):o=n?t.get(n):t.get(e),null!==o&&null!==i&&null!==s?s(o,i):null!=o})};if(e.expressions.length){var a,l,c,d,f,p,g,m,v=e.expressions,y=function(t){return t.tag=m,t};t:for(l=0;d=v[l];l++){for(a=0;f=d[a];a++){if(c=f.attributes,p=f.id,p&&(g={key:"id",value:p,operator:"="},c||(c=[]),c.push(g)),m=f.tag,m&&"*"!=m&&(c||(c=[{key:null,value:"",operator:"*"}]),c=o.map(c,y)),!c)continue t;o.forEach(c,h)}n[l]=r,r=this}}return o.flatten(n)},findOne:function(t){var e=this.find(t);return e.length?e[0]:null}});return o.forEach(["forEach","filter","map","some","indexOf","contains","invoke","every"],function(t){h.prototype[t]=function(e){return e=u(arguments),e.unshift(this._models),o[t].apply(this,e)}}),o.forIn({each:function(){return this.forEach.apply(this,arguments)},getRandom:function(){return this._models[o.random(0,this.length-1)]},getLast:function(){return this._models[this.length-1]}},function(t,e){h.prototype[e]=t}),h}),function(t){"function"==typeof define&&define.amd?define("epik/collection-sync",["./index","./collection","./agent"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./collection"),require("./agent")):this.epik.collection.sync=t(this.epik,this.epik.collection,this.epik.agent)}.call(this,function(t,e,i){var n=t.primish,r=t._;return n({extend:e,options:{urlRoot:"no-urlRoot-set",request:i.Request,headers:{"Content-Type":"application/json",Accept:"application/json,text/plain;q=0.2,text/html;q=0.1"}},constructor:function(t,e){return this._setupSync(),this.parent("constructor",t,e),this},_setupSync:function(){var t=this;return this.request=new this.options.request({url:this.options.urlRoot,method:"get",onFailure:function(e){t.trigger("sync:error",this.options.method,this.options.url,this.options.data),t.trigger("requestFailure",e.status,e.text)},onSuccess:function(e){t.postProcessor&&(e.body=t.postProcessor(e.body)),t.trigger("sync",e.body,t.request.options.method,t.request._data)}}),this.options.headers&&this.request.header(this.options.headers),this},fetch:function(t,e){var i=this;return this.request.data(e),this.request.send(function(e){var n=e.body;e.error||(t?(i.empty(),r.forEach(n,i.add,i)):i._processModels(n),i.trigger("fetch",n))}),this},_processModels:function(t){var e=this;return r.forEach(t,function(t){var i=t.id&&e.getModelById(t.id);i?i.set(t):e.add(t)}),this},postProcessor:function(t){return t}})}),function(t){"function"==typeof define&&define.amd?define("epik/view",["./index","./model","./collection","jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./model"),require("./collection"),require("./jquery")):this.epik.view=t(this.epik,this.epik.model,this.epik.collection,this.jQuery)}.call(this,function(t,e,i,n){var r=t.primish,s=t.emitter,o=t.options,u=t._,h=Array.prototype.slice,a=r({options:{template:"",events:{}},implement:[o,s],constructor:function(t){return this.collection=null,this.model=null,this.element=null,this.events={},t&&t.collection&&(this.setCollection(t.collection),delete t.collection),t&&t.model&&(this.setModel(t.model),delete t.model),t&&t.events&&(this.events=u.merge(this.events,t.events),delete t.events),this.setOptions(t),this.options.element&&(this.setElement(this.options.element,this.options.events),delete this.options.element),this.trigger("ready")},setModel:function(t){var i=this;return t instanceof e&&(this.model=t,this.listenTo(this.model,function(){var t=h.call(arguments);t[0]="model:"+t[0],i.trigger.apply(i,t)})),this},setCollection:function(t){var e=this;return t instanceof i&&(this.collection=t,this.listenTo(this.collection,function(){var t=h.call(arguments);t[0]="collection:"+t[0],e.trigger.apply(e,t)})),this},setElement:function(t,e){return this.element&&this.detachEvents()&&this.destroy(),this.$element=n(t),this.element=this.$element[0],e&&this.attachEvents(e),this},attachEvents:function(t){var e=this,i=this.$element,n="function",r=function(t){return function(){var i=h.call(arguments);e[t]&&typeof e[t]===n?e[t].apply(e,i):(i.unshift(t),e.trigger.apply(e,i))}};return this.bound||(this.bound={}),u.forIn(t,function(t,n){var s=n.split(/\s+/),o=r(t);s.push(o),i.on.apply(i,s),e.bound[n]||(e.bound[n]=[]),e.bound[n].push(o)}),this},detachEvents:function(){var t=this.$element,e=this.bound;u.forIn(this.bound,function(i,n){var r=n.split(/\s+/);r.push(i),t.off.apply(t,r);var s=u.indexOf(e[n],i);-1!==s&&e[n].splice(s,1),e[n].length||delete e[n]})},render:function(){return this.trigger("render")},empty:function(t){return t?this.$element.empty():this.element.innerHTML="",this.trigger("empty")},dispose:function(){return this.element.parentNode=null,this.trigger("dispose")},destroy:function(){return this.$element.remove(),this.detachEvents(),this.trigger("destroy")},template:function(t,e){e=e||this.options.template;var i=this.Template||u.template;return i(e,t)}});return a}),function(t){"function"==typeof define&&define.amd?define("epik/plugins/rivets-adapter",["../index","rivets"],t):this.epik.rivets=t(this.epik,this.rivets)}.call(this,function(t,e){var i=t.primish,n="model",r=function(t){return t._id===n};return e.configure({prefix:"ep",templateDelimiters:["{{","}}"]}),e.adapters["#"]={subscribe:function(t,e,i){t.on(r(t)?"empty destroy change:"+e:"set reset empty change sort",i)},unsubscribe:function(t,e,i){r(t)?(t.off("change:"+e,i),t.off("empty",i),t.off("destroy"+e,i)):(t.off("set",i),t.off("reset",i),t.off("empty",i),t.off("change",i),t.off("sort",i))},read:function(t,e){return r(t)?t.get(e):t._models},publish:function(t,e,i){r(t)?t.set(e,i):t.set(i)}},i({rivets:e,syncRivets:function(){this.boundRivets&&this.boundRivets.sync()&&this.trigger("render")},bindRivets:function(t,e){"undefined"==typeof e&&(e=t,t=this.element),this.boundRivets=this.rivets.bind(t,e)},unbindRivets:function(){this.boundRivets&&this.boundRivets.unbind(),delete this.boundRivets}})}),function(t){"function"==typeof define&&define.amd?define("epik/router",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.router=t(this.epik)}.call(this,function(t){var e=t.primish,i=t.emitter,n=t.options,r=t._,s="hashchange",o="on"+s in window,u=function(t){for(var e,i={},n=/([^&=]+)=([^&]*)/g;e=n.exec(t);)i[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return i};return e({implement:[i,n],options:{triggerOnLoad:!0},routes:{},boundEvents:{},constructor:function(t){this.setOptions(t),this.options.routes&&(this.routes=this.options.routes),this.monitorHash(),this.trigger("ready"),this.options.triggerOnLoad&&"function"==typeof this._monitor&&this.handleChange()},monitorHash:function(){if(o)this._monitor=r.bind(this.handleChange,this),window.addEventListener(s,this._monitor,!0);else{var t=location.hash,e=this;this._monitor=setInterval(function(){t!==location.hash&&(t=location.hash,e.handleChange(0===t.indexOf("#")?t.substr(1):t))})}return this},unmonitorHash:function(){"function"==typeof this._monitor?window.removeEventListener(s,this._monitor,!0):clearTimeout(this._monitor),delete this._monitor},handleChange:function(){var t,e,i=location.hash,n=i.split("?")[0],s=i.split("?")[1]||"",o=!0;for(t in this.routes){var h=[],a=this.normalize(t,h,!0,!1),l=a.exec(n),c=!1;if(l){o=!1,this.req=l[0];var d=l.slice(1),f={};r.forEach(d,function(t,e){"undefined"!=typeof h[e]&&(f[h[e].name]=t)}),this.route=t,this.param=f||{},this.query=s&&u(s),c=this.routes[t],this.trigger("before",c),c&&this._listeners[c]?(this.trigger(c+":before"),e=r.values(this.param),e.unshift(c),this.trigger.apply(this,e)):this.trigger("error",["Route",c,"is undefined"].join(" ")),this.trigger("after",c),c&&this.trigger(c+":after");break}}return o&&this.trigger("undefined"),this},navigate:function(t,e){return location.hash===t&&e?this.handleChange():location.hash=t,this},normalize:function(t,e,i,n){return t instanceof RegExp?t:(t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,i,n,r,s,o){return e.push({name:r,optional:!!o}),i=i||"",[o?"":i,"(?:",o?i:"",(n||"")+(s||n&&"([^/.]+?)"||"([^/]+?)")+")",o||""].join("")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",i?"":"i"))},addRoute:function(t){return t&&t.route&&t.id&&t.events?t.id.length?this.routes[t.route]?this.trigger("error",'Route "{route}" or id "{id}" already exists, aborting'.substitute(t)):(this.routes[t.route]=t.id,this.on(this.boundEvents[t.route]=t.events),this.trigger("route:add",t)):this.trigger("error","Route id cannot be empty, aborting"):this.trigger("error","Please include route, id and events in the argument object when adding a route")},removeRoute:function(t){return t&&this.routes[t]&&this.boundEvents[t]?(this.off(this.boundEvents[t]),delete this.routes[t],delete this.boundEvents[t],this.trigger("route:remove",t)):this.trigger("error","Could not find route or route is not removable")}})}),function(t){"function"==typeof define&&define.amd?define("slicker",t):"undefined"!=typeof module&&module.exports?module.exports=t():this.slicker=t()}.call(this,function(){function t(t,s,o,h,l,d,f,p,g,m,v,y,b,x,_,k){if((s||-1===i)&&(e.expressions[++i]=[],n=-1,s))return"";if(o||h||-1===n){o=o||" ";var w=e.expressions[i];r&&w[n]&&(w[n].reverseCombinator=a(o)),w[++n]={combinator:o,tag:"*"}}var q=e.expressions[i][n];if(l)q.tag=l.replace(u,"");else if(d)q.id=d.replace(u,"");else if(f)f=f.replace(u,""),q.classList||(q.classList=[]),q.classes||(q.classes=[]),q.classList.push(f),q.classes.push({value:f,regexp:new RegExp("(^|\\s)"+c(f)+"(\\s|$)")});else if(b)k=k||_,k=k?k.replace(u,""):null,q.pseudos||(q.pseudos=[]),q.pseudos.push({key:b.replace(u,""),value:k,type:1==y.length?"class":"element"});else if(p){p=p.replace(u,""),v=(v||"").replace(u,"");var O,R;switch(g){case"^=":R=new RegExp("^"+c(v));break;case"$=":R=new RegExp(c(v)+"$");break;case"~=":R=new RegExp("(^|\\s)"+c(v)+"(\\s|$)");break;case"|=":R=new RegExp("^"+c(v)+"(-|$)");break;case"=":O=function(t){return v==t};break;case"*=":O=function(t){return t&&t.indexOf(v)>-1};break;case"!=":O=function(t){return v!=t};break;default:O=function(t){return!!t}}""===v&&/^[*$^]=$/.test(g)&&(O=function(){return!1}),O||(O=function(t){return t&&R.test(t)}),q.attributes||(q.attributes=[]),q.attributes.push({key:p,operator:g,value:v,test:O})}return""}var e,i,n,r,s={},o={},u=/\\/g,h=function(n,u){if(null==n)return null;if(n.Slick===!0)return n;n=(""+n).replace(/^\s+|\s+$/g,""),r=!!u;var a=r?o:s;if(a[n])return a[n];for(e={Slick:!0,expressions:[],raw:n,reverse:function(){return h(this.raw,!0)}},i=-1;n!=(n=n.replace(d,t)););return e.length=e.expressions.length,a[e.raw]=r?l(e):e},a=function(t){return"!"===t?" ":" "===t?"!":/^!/.test(t)?t.replace(/^!/,""):"!"+t},l=function(t){for(var e=t.expressions,i=0;i<e.length;i++){for(var n=e[i],r={parts:[],tag:"*",combinator:a(n[0].combinator)},s=0;s<n.length;s++){var o=n[s];o.reverseCombinator||(o.reverseCombinator=" "),o.combinator=o.reverseCombinator,delete o.reverseCombinator}n.reverse().push(r)}return t},c=function(){var t=/(?=[\-\[\]{}()*+?.\\\^$|,#\s])/g,e="\\";return function(i){return i.replace(t,e)}}(),d=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+c(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));return{parse:function(t){return h(t)},escapeRegExp:c}});