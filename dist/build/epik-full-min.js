(function(t){"function"==typeof define&&define.amd?define("epik/index",["primish/primish","primish/options","primish/emitter","lodash"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("primish"),require("primish/options"),require("primish/emitter"),require("lodash")):this.epik=t(this.primish,this.options,this.emitter,this._)}).call(this,function(t,e,i,n,r){var s=Array.prototype.slice;i=t({extend:i,listenTo:function(e,i,r){var s=typeof i,o={context:e,subscriber:this},u=e._subscribers||t.hide(e,"_subscribers");return"function"===s?(r=i,i="*",delete o.event):"undefined"===s?(i="*",delete o.event):"string"===s&&(o.event=i),r&&(o.fn=r),u[i]||(u[i]=[]),-1===n.indexOf(u[i],o)&&u[i].push(o),this},stopListening:function(t,e,i){return n.forIn(t._subscribers,function(n,r,s){if(s=n.length,"undefined"!=typeof e){if(r===e)for(;s--;)(i&&i===n[s].fn||!i)&&n[s].context===t&&n.splice(s,1)}else for(;s--;)n[s].context===t&&n.splice(s,1)}),this},trigger:function(t){var e,i,n,r,o=this._listeners,u=this._subscribers,h=s.call(arguments,1),l={};if(o&&(e=o[t])){for(i in e)l[i]=e[i];for(i in l)l[i].apply(this,h)}if(u){for(e=u["*"]||[],i=0;i<e.length;i++)r=e[i],n=r.event?h:arguments,r.fn?r.fn.apply(r.context,n):this.trigger.apply(r.subscriber,n);for(e=u[t]||[],i=0;i<e.length;i++)r=e[i],n=r.event?h:arguments,r.fn?r.fn.apply(r.context,n):this.trigger.apply(r.subscriber,n)}return this},offAll:function(t){var e,i=this._listeners,n=this._subscribers;return t&&t.length?(i&&(e=i[t])&&delete i[t],n&&(e=n[t])&&delete n[t],this):(this._listeners={},this._subscribers={},this)}});var o={setter:function(t){return function(e,i){if(null==e)return t;if(n.isObject(e))for(var r in e)t.call(this,r,e[r]);else t.call(this,e,i)}},getter:function(t){return function(e){var i,n,r;if(n="string"!=typeof e?e:arguments.length>1?arguments:!1)for(i={},r=0;r<n.length;r++)i[n[r]]=t.call(this,n[r]);else i=t.call(this,e);return i}}};return i.prototype.on=o.setter(i.prototype.on),{_:n,primish:t,options:e,emitter:i,slicker:r,util:o}}),define("lib/index",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/agent",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.agent=t(this.epik)}.call(this,function(t){var e=t.primish,i=t.emitter,n=t.options,r=t._,s=function(){var t=String.prototype.trim;return t?function(e){return t.call(e)}:function(t){return String(t).replace(/^\s+|\s+$/gm,"")}}(),o=function(t){return String(t).replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},u=function(){var t=function(){return new XMLHttpRequest},e=function(){return new ActiveXObject("MSXML2.XMLHTTP")},i=function(){return new ActiveXObject("Microsoft.XMLHTTP")};try{return t(),t}catch(n){}try{return e(),e}catch(n){}try{return i(),i}catch(n){}return null}(),h=function(t){return null==t?"":t.toJSON?t.toJSON():JSON.stringify(t)},l=function(t,e){if(null==t)return"";if(t.toQueryString)return t.toQueryString();var i=[];return r.forIn(t,function(t,n){e&&(t=e+"["+t+"]");var s;if(null!=n){if(r.isArray(n)){for(var o={},u=0;u<n.length;u++)o[u]=n[u];s=l(o,t)}else s=r.isObject(n)?l(n,t):t+"="+encodeURIComponent(n);i.push(s)}}),i.join("&")},a=JSON.parse,c=function(t){for(var e=t.split("&"),i={},n=0;n<e.length;n++){var r=e[n].split("="),s=decodeURIComponent(r[0]),o=decodeURIComponent(r[1]),u=/\[\]$/.test(s),h=s.match(/^(.+)\[([^\]]+)\]$/);if(h){s=h[1];var l=h[2];i[s]=i[s]||{},i[s][l]=o}else u?(s=s.substring(0,s.length-2),i[s]=i[s]||[],i[s].push(o)):i[s]=o}return i},d={"application/json":h,"application/x-www-form-urlencoded":l},f={"application/json":a,"application/x-www-form-urlencoded":c},p=function(t){var e=t.split(/\r?\n/),i={};e.pop();for(var n=0,r=e.length;r>n;++n){var u=e[n],h=u.indexOf(":"),l=o(u.slice(0,h)),a=s(u.slice(h+1));i[l]=a}return i},g=e({options:{header:{"Content-Type":"application/x-www-form-urlencoded"},url:null,method:"post",data:null,user:null,password:null,emulation:!1},implement:[i,n],constructor:function(t){var e=this._xhr=u(),i=this;this.setOptions(t),this.options.data&&this.data(r.clone(this.options.data)),this.options.header&&this.header(this.options.header),e.addEventListener&&r.forEach("progress|load|error|abort|loadend".split("|"),function(t){e.addEventListener(t,function(e){i.trigger(t,e)},!1)})},header:function(t,e){var i=this.options.header;if(r.isObject(t))for(var n in t)this.header(n,t[n]);else{if(!arguments.length)return i;if(1===arguments.length)return i[o(t)];2===arguments.length&&(null==e?delete i[o(t)]:i[o(t)]=e)}return this},running:function(){return!!this._running},abort:function(){return this._running&&(this._xhr.abort(),delete this._running,this._xhr.onreadystatechange=function(){},this._xhr=u()),this},method:function(t){return arguments.length?(this.setOptions({method:t.toUpperCase()}),this):this.options.method},data:function(t){return arguments.length?(this._data=t,this):this._data},url:function(t){return arguments.length?(this.setOptions({url:t}),this):this.options.url},user:function(t){return arguments.length?(this.setOptions({user:t}),this):this.options.user},password:function(t){return arguments.length?(this.setOptions({password:t}),this):this.options.password},send:function(t){t||(t=function(){}),this._running&&this.abort();var e,i=this.options,n=i.method,r=this._data||null,s=i.url,o=i.user,u=i.password,h=this,l=this._xhr;if(i.emulation&&/get|post/i.test(n)){var a="_method="+n;r=r?a+"&"+r:a,n="post"}r&&"string"!=typeof r&&(e=d[i.header["Content-Type"].split(/ *; */).shift()],e&&(r=e(r))),/get|head/i.test(n)&&r&&(s+=(s.indexOf("?")>-1?"&":"?")+r),this._running=!0,l.open(n,s,!0,o,u),null!=o&&"withCredentials"in l&&(l.withCredentials=!0),l.onreadystatechange=function(){if(4===l.readyState){var e=l.status,i=new m(l.responseText,e,p(l.getAllResponseHeaders()));delete h._running,l.onreadystatechange=function(){},h.trigger(i.error?"failure":"success",i).trigger("complete",i),t(i)}};for(var c in i.header)l.setRequestHeader(c,i.header[c]);return this.trigger("request"),l.send(r||null),this}}),m=e({constructor:function(t,e,i){this.text=t,this.status=e;var n,r=i["Content-Type"]?i["Content-Type"].split(/ *; */).shift():"",s=e/100|0;this.header=i,this.info=1===s,this.ok=2===s,this.clientError=4===s,this.serverError=5===s,this.error=4===s||5===s,this.accepted=202===e,this.noContent=204===e||1223===e,this.badRequest=400===e,this.unauthorized=401===e,this.notAcceptable=406===e,this.notFound=404===e,this.noContent||(n=f[r]),this.body=n?n(this.text):this.text},header:function(t){return t?this._header[o(t)]:null}}),v="get|post|put|delete|head|patch|options",y=RegExp("^"+v+"$","i"),b=function(t,e,i,n){var s=new g;return y.test(t)||(n=i,i=e,e=t,t="post"),r.isFunction(i)&&(n=i,i=null),s.method(t),e&&s.url(e),i&&s.data(i),n&&s.send(n),s};return b.encoder=function(t,e){return 1===arguments.length?d[t]:(d[t]=e,b)},b.decoder=function(t,e){return 1===arguments.length?f[t]:(f[t]=e,b)},r.forEach(v.split("|"),function(t){b[t]=function(e,i,n){return b(t,e,i,n)}}),b.Request=g,b.Response=m,b}),define("lib/agent",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/model",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.model=t(this.epik)}.call(this,function(t){var e=t.primish,i=t.options,n=t.emitter,r=t._,s=t.util;return e("model",{implement:[i,n],properties:{id:{get:function(){var t=this._attributes.id||r.uniqueId("model-");return this.cid||(this.cid=t),this._attributes.id||t}}},options:{},validators:[],constructor:function(t,e){return this._collections=[],this._attributes={},t&&"object"==typeof t||(t={}),this.defaults&&r.defaults(t,r.clone(this.defaults)),this.set(t),this.setOptions(e),this.trigger("ready")},set:function(){return this.propertiesChanged=[],this.validationFailed=[],this._set.apply(this,arguments),this.propertiesChanged.length&&this.trigger("change",this.propertiesChanged),this.validationFailed.length&&this.trigger("error",this.validationFailed),this},_set:s.setter(function(t,e){if(!t||"undefined"==typeof e)return this;if(this.properties[t]&&this.properties[t].set&&(e=this.properties[t].set.call(this,e),"undefined"==typeof e))return this;if(this._attributes[t]&&r.isEqual(this._attributes[t],e))return this;var i=this.validate(t,e);if(this.validators[t]&&i!==!0){var n={key:t,value:e,error:i};return this.validationFailed.push(n),this.trigger("error:"+t,n),this}return null===e?delete this._attributes[t]:this._attributes[t]=e,this.trigger("change:"+t,e),this.propertiesChanged.push(t),this}),get:s.getter(function(t){return t&&this.properties[t]&&this.properties[t].get?this.properties[t].get.call(this):t&&"undefined"!=typeof this._attributes[t]?this._attributes[t]:null}),validate:function(t,e){return t in this.validators?this.validators[t].call(this,e):!0},unset:function(){var t=Array.prototype.slice.apply(arguments),e={},i=t.length;return i?(r.forEach(r.flatten(t),function(t){e[t]=null}),this.set(e),this):this},empty:function(){var t=r.keys(this._attributes),e=this;this.trigger("change",t),r.forEach(t,function(t){e.trigger("change:"+t,null)}),this._attributes={},this.trigger("empty")},destroy:function(){this._attributes={},this.trigger("destroy")},toJSON:function(){return r.clone(this._attributes)}})}),define("lib/model",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/model-sync",["./index","./model","./agent"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./model"),require("./agent")):this.epik.model.sync=t(this.epik,this.epik.model,this.epik.agent)}.call(this,function(t,e,i){var n=t.primish,r=t._,s="sync:",o={create:"post",read:"get",update:"put",delete_:"delete"};return n({extend:e,properties:n.merge(e.prototype.properties,{urlRoot:{set:function(t){this.urlRoot=t,delete this._attributes.urlRoot},get:function(){var t=this.urlRoot||this.options.urlRoot||"no-urlRoot-set";return"/"!==t.charAt(t.length-1)&&(t+="/"),t}}}),options:{headers:{"Content-Type":"application/json"}},constructor:function(t,e){return this._attributes={},this.setOptions(e),this._setupSync(),this.parent("constructor",t,e),this},_setupSync:function(){var t=this;return this.request=new i.Request({url:this.get("urlRoot"),onFailure:function(e){t.trigger(s+"error",this.options.method,this.options.url,this.options.data),t.trigger("requestFailure",e.status,e.text)},onSuccess:function(e){t.postProcessor&&(e.body=t.postProcessor(e.body)),t.isNewModel=!1,t.trigger("sync",e.body,t.request.options.method,t.request._data)}}),this.options.headers&&this.request.header(this.options.headers),r.forIn(o,function(e,i){t[i]=function(t){this.sync(i,this.toJSON(),t)}}),this},sync:function(t,e,i){var n,r={},s=this;return t="string"==typeof t?t&&o[t]?o[t]:o.read:o.read,r.method=t,n=typeof e,"function"===n&&(i=e),("undefined"===n||"function"===n)&&(e=this.toJSON()),this.request.data(void 0),(t===o.create||t===o.update)&&(this.preProcessor&&(e=this.preProcessor(e)),this.request.data(e)),r.url=this.get("urlRoot")+this.get("id"),"/"!==r.url.slice(-1)&&(r.url+="/"),delete this.request.options,this.request.setOptions(r).send(function(t){s.trigger(t.error?"failure":"success",t),i&&i.call(s,t)}),this},_setResponse:function(t){return t.body&&"object"==typeof t.body&&this.set(t.body),this},fetch:function(){return this.read(function(t){t.error||(this.isNewModel=!1,this._setResponse(t).trigger("fetch"))}),this},save:function(t,e){var i=["update","create"][+this.isNew()];if(t){var n=typeof t,s="object"===n&&r.isObject(t)||"string"===n&&"undefined"!=typeof e;s&&this._set.apply(this,arguments)}return this[i](function(t){t.error||(this.isNewModel=!1,this._setResponse(t).trigger("save").trigger(i))}),this},isNew:function(){return"undefined"==typeof this.isNewModel&&(this.isNewModel=!!this.get("id")),this.isNewModel}})}),define("lib/model-sync",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/storage",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.storage=t(this.epik)}.call(this,function(t){var e=t.primish,i=t._,n=this;return function(){var t=!("object"!=typeof n.localStorage||!n.localStorage.getItem),r="localStorage",s="sessionStorage",o=function(r){var s,o="epik-"+r,u={},h="model";if(t)try{u=JSON.parse(n[r].getItem(o))||u}catch(l){t=!1}if(!t)try{s=JSON.parse(n.name),s&&"object"==typeof s&&s[o]&&(u=s[o])}catch(a){g()}var c={store:function(t){t=t||this.toJSON(),f([h,this.get("id")].join(":"),t),this.trigger("store",t)},eliminate:function(){return p([h,this.get("id")].join(":")),this.trigger("eliminate")},retrieve:function(){var t=d([h,this.get("id")].join(":"))||null;return this.trigger("retrieve",t),t}},d=function(t){return t in u?u[t]:null},f=function(e,i){if(u=t?JSON.parse(n[r].getItem(o))||u:u,u[e]=i,t)try{n[r].setItem(o,JSON.stringify(u))}catch(s){}else g();return this},p=function(e){if(delete u[e],t)try{n[r].setItem(o,JSON.stringify(u))}catch(i){}else g()},g=function(){var t={},e=JSON.parse(n.name);t[o]=u,n.name=JSON.stringify(i.merge(t,e))};return function(t){return h=t,e(i.clone(c))}};return{localStorage:o(r),sessionStorage:o(s)}}()}),define("lib/storage",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/collection",["./index","./model","slicker"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./model"),require("slicker")):this.epik.collection=t(this.epik,this.epik.model,this.slicker)}.call(this,function(t,e,i){var n=t.primish,r=t.options,s=t.emitter,o=t._,u=Array.prototype.slice,h=n("collection",{implement:[s,r],model:e,constructor:function(t,e){return this.setOptions(e),this._models=[],this.length=0,t&&this.set(t,!0),this.id=this.options.id||o.uniqueId(),this.trigger("ready")},set:function(t,e){var i=this;return this.length&&this.remove(this._models,!0),o.isArray(t)||(t=[t]),o.forEach(t,function(t){i.add(t,!0)}),e||this.trigger("set",this._models),this},add:function(t,e){var i,n=this;return!o.isObject(t)||t instanceof this.model||(t=new this.model(t)),t.cid=t.cid||t.get("id")||o.uniqueId("c"),i=this.getModelByCID(t.cid),i&&e!==!0?this.trigger("add:error",t):(i&&e===!0&&(this._models[o.indexOf(this._models,t)]=t),this.listenTo(t,function(e){var i=u.call(arguments);i.splice(1,0,t),n.trigger.apply(n,i),"destroy"===e&&n.remove(t,!0)}),this._models.push(t),-1===o.indexOf(t._collections,this)&&t._collections.push(this),this.length=this._models.length,this.trigger("add",t,t.cid).trigger("reset",t,t.cid))},remove:function(t,e){var i=this;return o.isArray(t)||(t=[t]),o.forEachRight(t,function(t){t._collections.splice(o.indexOf(t._collections,i),1),i._models.splice(o.indexOf(i._models,t),1),i.stopListening(t),i.length=i._models.length,e||i.trigger("remove",t,t.cid)}),e||this.trigger("set",t),this},get:function(t){return this[t]},getModelByCID:function(t){var e=null;return this.some(function(i){return i.cid===t&&(e=i)}),e},getModelById:function(t){var e=null;return this.some(function(i){return i.get("id")===t&&(e=i)}),e},at:function(t){return this._models[t]},toJSON:function(){return this.map(this._models,function(t){return t.toJSON()})},empty:function(t){return this.remove(this._models,t),this.trigger("empty")},sort:function(t){if(!t)return this._models.sort(),this.trigger("sort");if("function"==typeof t)return this.model.sort(t),this.trigger("sort");var e="asc",i=t.split(","),n=function(t,e){return e>t?-1:t>e?1:0};return this._models.sort(function(t,r){var s=0;return o.some(i,function(i){i=i.trim();var o=i.split(":"),u=o[0],h=o[1]?o[1]:e,l=t.get(u),a=r.get(u),c=n(l,a),d={asc:c,desc:-c};return"undefined"==typeof d[h]&&(h=e),s=d[h],0!==s}),s}),this.trigger("sort")},reverse:function(){return this._models.reverse(),this.trigger("sort")},find:function(t){var e=i.parse(t),n=[],r=this,s={"=":function(t,e){return t==e},"!=":function(t,e){return t!=e},"^=":function(t,e){return 0===t.indexOf(e)},"*=":function(t,e){return-1!==t.indexOf(e)},"$=":function(t,e){return t.indexOf(e)==t.length-e.length},"*":function(t){return"undefined"!=typeof t}},u=function(t){return t&&s[t]?s[t]:null},h=function(t){var e=t.key,i=t.value||null,n=t.tag||null,s=u(t.operator);r=r.filter(function(t){var r,o;return n&&e?(r=t.get(n),o=r?r[e]:null):o=n?t.get(n):t.get(e),null!==o&&null!==i&&null!==s?s(o,i):null!=o})};if(e.expressions.length){var l,a,c,d,f,p,g,m,v=e.expressions,y=function(t){return t.tag=m,t};t:for(a=0;d=v[a];a++){for(l=0;f=d[l];l++){if(c=f.attributes,p=f.id,p&&(g={key:"id",value:p,operator:"="},c||(c=[]),c.push(g)),m=f.tag,m&&"*"!=m&&(c||(c=[{key:null,value:"",operator:"*"}]),c=o.map(c,y)),!c)continue t;o.forEach(c,h)}n[a]=r,r=this}}return o.flatten(n)},findOne:function(t){var e=this.find(t);return e.length?e[0]:null}});return o.forEach(["forEach","filter","map","some","indexOf","contains","invoke","every"],function(t){h.prototype[t]=function(e){return e=u.call(arguments),e.unshift(this._models),o[t].apply(this,e)}}),o.forIn({each:function(){return this.forEach.apply(this,arguments)},getRandom:function(){return this._models[o.random(0,this.length-1)]},getLast:function(){return this._models[this.length-1]}},function(t,e){h.prototype[e]=t}),h}),define("lib/collection",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/collection-sync",["./index","./collection","./agent"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./collection"),require("./agent")):this.epik.collection.sync=t(this.epik,this.epik.collection,this.epik.agent)}.call(this,function(t,e,i){var n=t.primish,r=t._;return n({extend:e,options:{urlRoot:"no-urlRoot-set",request:i.Request,headers:{"Content-Type":"application/json",Accept:"application/json,text/plain;q=0.2,text/html;q=0.1"}},constructor:function(t,e){return this._setupSync(),this.parent("constructor",t,e),this},_setupSync:function(){var t=this;return this.request=new this.options.request({url:this.options.urlRoot,method:"get",onFailure:function(e){t.trigger("sync:error",this.options.method,this.options.url,this.options.data),t.trigger("requestFailure",e.status,e.text)},onSuccess:function(e){t.postProcessor&&(e.body=t.postProcessor(e.body)),t.trigger("sync",e.body,t.request.options.method,t.request._data)}}),this.options.headers&&this.request.header(this.options.headers),this},fetch:function(t,e){var i=this;return this.request.data(e),this.request.send(function(e){var n=e.body;e.error||(t?(i.empty(),r.forEach(n,i.add,i)):i._processModels(n),i.trigger("fetch",n))}),this},_processModels:function(t){var e=this;return r.forEach(t,function(t){var i=t.id&&e.getModelById(t.id);i?i.set(t):e.add(t)}),this},postProcessor:function(t){return t}})}),define("lib/collection-sync",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/view",["./index","./model","./collection","jquery"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index"),require("./model"),require("./collection"),require("./jquery")):this.epik.view=t(this.epik,this.epik.model,this.epik.collection,this.jQuery)}.call(this,function(t,e,i,n){var r=t.primish,s=t.emitter,o=t.options,u=t._,h=Array.prototype.slice,l=r({options:{template:"",events:{}},implement:[o,s],constructor:function(t){return this.collection=null,this.model=null,this.element=null,this.events={},t&&t.collection&&(this.setCollection(t.collection),delete t.collection),t&&t.model&&(this.setModel(t.model),delete t.model),t&&t.events&&(this.events=u.merge(this.events,t.events),delete t.events),this.setOptions(t),this.options.element&&(this.setElement(this.options.element,this.options.events),delete this.options.element),this.trigger("ready")},setModel:function(t){var i=this;return t instanceof e&&(this.model=t,this.listenTo(this.model,function(){var t=h.call(arguments);t[0]="model:"+t[0],i.trigger.apply(i,t)})),this},setCollection:function(t){var e=this;return t instanceof i&&(this.collection=t,this.listenTo(this.collection,function(){var t=h.call(arguments);t[0]="collection:"+t[0],e.trigger.apply(e,t)})),this},setElement:function(t,e){return this.element&&this.detachEvents()&&this.destroy(),this.$element=n(t),this.element=this.$element[0],e&&this.attachEvents(e),this},attachEvents:function(t){var e=this,i=this.$element,n="function",r=function(t){return function(){var i=h.call(arguments);e[t]&&typeof e[t]===n?e[t].apply(e,i):(i.unshift(t),e.trigger.apply(e,i))}};return this.bound||(this.bound={}),u.forIn(t,function(t,n){var s=n.split(/\s+/),o=r(t);s.push(o),i.on.apply(i,s),e.bound[n]||(e.bound[n]=[]),e.bound[n].push(o)}),this},detachEvents:function(){var t=this.$element,e=this.bound;u.forIn(this.bound,function(i,n){var r=n.split(/\s+/);r.push(i),t.off.apply(t,r);var s=u.indexOf(e[n],i);-1!==s&&e[n].splice(s,1),e[n].length||delete e[n]})},render:function(){return this.trigger("render")},empty:function(t){return t?this.$element.empty():this.element.innerHTML="",this.trigger("empty")},dispose:function(){return this.element.parentNode=null,this.trigger("dispose")},destroy:function(){return this.$element.remove(),this.detachEvents(),this.trigger("destroy")},template:function(t,e){e=e||this.options.template;var i=this.Template||u.template;return i(e,t)}});return l}),define("lib/view",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/plugins/rivets-adapter",["../index","rivets"],t):this.epik.rivets=t(this.epik,this.rivets)}.call(this,function(t,e){var i=t.primish,n="model",r=function(t){return t._id===n};return e.configure({prefix:"ep",templateDelimiters:["{{","}}"]}),e.adapters["#"]={subscribe:function(t,e,i){r(t)?t.on("empty destroy change:"+e,function(){i()}):t.on("reset empty change sort",function(){i()})},unsubscribe:function(t,e,i){r(t)?(t.off("change:"+e,i),t.off("empty",i),t.off("destroy"+e,i)):(t.off("reset",i),t.off("empty",i),t.off("change",i),t.off("sort",i))},read:function(t,e){return r(t)?t.get(e):t._models},publish:function(t,e,i){r(t)?t.set(e,i):t.set(i)}},i({rivets:e,syncRivets:function(){this.boundRivets&&this.boundRivets.sync()&&this.trigger("render")},bindRivets:function(t,e){"undefined"==typeof e&&(e=t,t=this.element),this.boundRivets=this.rivets.bind(t,e)},unbindRivets:function(){this.boundRivets&&this.boundRivets.unbind(),delete this.boundRivets}})}),define("lib/plugins/rivets-adapter",function(){}),function(t){"function"==typeof define&&define.amd?define("epik/router",["./index"],t):"undefined"!=typeof module&&module.exports?module.exports=t(require("./index")):this.epik.router=t(this.epik)}.call(this,function(t){var e=t.primish,i=t.emitter,n=t.options,r=t._,s="hashchange",o="on"+s in window,u=function(t){for(var e,i={},n=/([^&=]+)=([^&]*)/g;e=n.exec(t);)i[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return i};return e({implement:[i,n],options:{triggerOnLoad:!0},routes:{},boundEvents:{},constructor:function(t){this.setOptions(t),this.options.routes&&(this.routes=this.options.routes),this.monitorHash(),this.trigger("ready"),this.options.triggerOnLoad&&"function"==typeof this._monitor&&this.handleChange()},monitorHash:function(){if(o)this._monitor=r.bind(this.handleChange,this),window.addEventListener(s,this._monitor,!0);else{var t=location.hash,e=this;this._monitor=setInterval(function(){t!==location.hash&&(t=location.hash,e.handleChange(0===t.indexOf("#")?t.substr(1):t))})}return this},unmonitorHash:function(){"function"==typeof this._monitor?window.removeEventListener(s,this._monitor,!0):clearTimeout(this._monitor),delete this._monitor},handleChange:function(){var t,e,i=location.hash,n=i.split("?")[0],s=i.split("?")[1]||"",o=!0;for(t in this.routes){var h=[],l=this.normalize(t,h,!0,!1),a=l.exec(n),c=!1;if(a){o=!1,this.req=a[0];var d=a.slice(1),f={};r.forEach(d,function(t,e){"undefined"!=typeof h[e]&&(f[h[e].name]=t)}),this.route=t,this.param=f||{},this.query=s&&u(s),c=this.routes[t],this.trigger("before",c),c&&this._listeners[c]?(this.trigger(c+":before"),e=r.values(this.param),e.unshift(c),this.trigger.apply(this,e)):this.trigger("error",["Route",c,"is undefined"].join(" ")),this.trigger("after",c),c&&this.trigger(c+":after");break}}return o&&this.trigger("undefined"),this},navigate:function(t,e){return location.hash===t&&e?this.handleChange():location.hash=t,this},normalize:function(t,e,i,n){return t instanceof RegExp?t:(t=t.concat(n?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,i,n,r,s,o){return e.push({name:r,optional:!!o}),i=i||"",[o?"":i,"(?:",o?i:"",(n||"")+(s||n&&"([^/.]+?)"||"([^/]+?)")+")",o||""].join("")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",i?"":"i"))},addRoute:function(t){return t&&t.route&&t.id&&t.events?t.id.length?this.routes[t.route]?this.trigger("error",'Route "{route}" or id "{id}" already exists, aborting'.substitute(t)):(this.routes[t.route]=t.id,this.on(this.boundEvents[t.route]=t.events),this.trigger("route:add",t)):this.trigger("error","Route id cannot be empty, aborting"):this.trigger("error","Please include route, id and events in the argument object when adding a route")},removeRoute:function(t){return t&&this.routes[t]&&this.boundEvents[t]?(this.off(this.boundEvents[t]),delete this.routes[t],delete this.boundEvents[t],this.trigger("route:remove",t)):this.trigger("error","Could not find route or route is not removable")}})}),define("lib/router",function(){});